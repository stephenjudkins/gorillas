<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Gorillas</title>
<script type="application/javascript" src="jquery-1.4.js"></script>
<script type="application/javascript" src="raphael.js"></script>
<style>
  article, aside, dialog, figure, footer, header,
  hgroup, menu, nav, section { display: block; }
  body {
    background: #ddd;
  }
  #canvas {
    cursor:crosshair;
  }
</style>
</head>
<body>
<div id="canvas"></div>

<script type="application/javascript">
  $(function() {
    var width = 1000;
    var height = 400;
    var r = 20;
    var paper = Raphael("canvas", width, height);
    window.paper = paper;
    var rect = paper.rect(0,0, width, height);
    rect.attr({"stroke-width":0});
    // paper.draw(0, $)

    rect.attr('fill', 'white');    
    rect.click(function(event) {
      var x = event.pageX, y = event.pageY;
      // ;
      drawArc(x,y);
    });

    var path = paper.path('M 0 400' + 'Q 500 -400 1000 400');
    path.attr({stroke:"#555", "stroke-width":2, "stroke-dasharray":"- ", "stroke-opacity":.25});

    // var drawCircle = function(x, y, color) {
    //   var circle = paper.circle(x, y, r);
    //   color = color || 'red';
    //   circle.attr({fill: '#f72', "stroke-width": "2", "stroke-dasharray": "-."});
    //   circle.animate({"rotation":-280}, 2000, ">");
    //   return circle;
    // };

    var drawCircle = function(x, y) {
      var circle = paper.image("banana-40px.png", x, y, 40, 41);
      circle.animate({"rotation":700}, 3000, ">");
      return circle;
    };
    
    var drawTarget = function(x, y, color) {
      var circle = paper.circle(x, y, (r - (r * .25)));
      color = color || '#666';
      circle.attr({fill: '#aaa', "opacity": ".8", "stroke":"#333", "stroke-width": "3", "stroke-opacity": ".6"});
      circle.animate({"opacity":0}, 800, "<")
      return circle;
    };
    
    var gravity = 1;

    var drawArc = function(x, y) {
      var vy = Math.sqrt(4 * gravity * (height - y));

      var vx = (2 * gravity * x)  / vy;

      drawTarget(x,y, "#f00");
      
      var circle = drawCircle(0, height);

      var next = function(i) {
        var t = i / 3.5;
        var y = (-gravity * Math.pow(t, 2)) + (vy * t);
        y = height - y;

        var x = vx * t;

        var x = x - 20, y = y - 20;
        var dx = x - circle.attr('x');
        var dy = y - circle.attr('y');
        
        circle.translate(dx, dy);

        // console.log([x, y]);
        // console.log([(height - 2 * r), (width - 2 * r)])
        if ((y > height) || (x > width)) { 
          // circle.remove();
          return;
        }
        setTimeout(function() { next (i + 1); });
      };
        
      next(0);


    };
    
    var randomThrow = function() {
      var x = Math.random() * width, y = Math.random() * height;
      // console.log([x,y]);
      drawArc(x, y);
      setTimeout(randomThrow, 400);
    }
    // randomThrow();
    

  });

</script>
</body>
</html>
